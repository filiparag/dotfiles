#!/bin/sh

export WMRC_DEPENDENCIES='dunstify'

NO_TITLE="Notification has no title provided!"

ask() {

  [ -z "$2" ] && \
    {
      error "$NO_TITLE"
      exit 2
    }
  debug "$(echo "[Prompt] $2: $3" | sed 's:<i>::g; s:</i>::g')"

  INDEX=1
  CHOICES=""
  for P in "$@"; do
    [ $INDEX -gt 3 ] && \
      CHOICES="$CHOICES -A $INDEX,$(echo "$P" | sed "s/ /_/g")"
    INDEX=$((INDEX + 1))
  done

  [ -z "$CHOICES" ] && \
    {
      error "Prompt '$1' has no answer options provided!"
      exit 3
    }

  ANS="$(dunstify -u low -i "dialog-question" "$1" "$2" -a ask $CHOICES)"

  [ "$ANS" -lt 4 ] && \
    {
      error "Prompt '$1' not answered!"
      exit 4
    }

  INDEX=1
  for P in "$@"; do
    if [ "$INDEX" = "$ANS" ]; then
      debug "Prompt '$1' answered" "$INDEX"
      return
    fi
    INDEX=$((INDEX + 1))
  done

}

info() {

  [ -z "$1" ] && \
    {
      error "$NO_TITLE"
      exit 2
    }
  debug "$(echo "[Info] $1: $2" | sed 's:<i>::g; s:</i>::g')"
  dunstify -u low -i "dialog-info" "$1" "$2"

}

warn() {

  [ -z "$1" ] && \
    {
      error "$NO_TITLE"
      exit 2
    }
  debug "$(echo "[Warning] $1: $2" | sed 's:<i>::g; s:</i>::g')"
  dunstify -u low -i "dialog-warning" "$1" "$2"

}

err() {

  [ -z "$1" ] && \
    {
      error "$NO_TITLE"
      exit 2
    }
  debug "$(echo "[Error] $1: $2" | sed 's:<i>::g; s:</i>::g')"
  dunstify -u low -i "dialog-error" "$1" "$2"

}

pause() {

  debug "Notifications paused"
  pkill -u "$USER" -USR1 dunst

}

resume() {

  debug "Notifications resumed"
  pkill -u "$USER" -USR2 dunst

}
